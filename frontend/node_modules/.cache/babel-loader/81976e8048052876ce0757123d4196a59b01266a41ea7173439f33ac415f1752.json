{"ast":null,"code":"var _jsxFileName = \"/Users/jsy/Desktop/ai-travel-app/frontend/src/pages/MapView.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { Popup } from 'react-leaflet';\nimport { MapContainer, TileLayer, Marker, useMap, useMapEvents } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet-control-geocoder/dist/Control.Geocoder.css';\nimport 'leaflet-control-geocoder'; // 默认挂载到 L.Control.Geocoder\n\nimport './MapView.css';\n\n// 修复图标不显示\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'\n});\n\n// 搜索控件\nfunction GeocoderControl({\n  setSearchMarker\n}) {\n  _s();\n  const map = useMap();\n  useEffect(() => {\n    if (!map || !L.Control.Geocoder) return;\n    const geocoder = L.Control.geocoder({\n      position: 'topleft',\n      defaultMarkGeocode: true,\n      placeholder: 'Search location...',\n      geocoder: L.Control.Geocoder.nominatim()\n    }).addTo(map);\n    geocoder.on('markgeocode', function (e) {\n      const {\n        center,\n        name\n      } = e.geocode;\n      map.setView(center, map.getZoom());\n\n      // ✅ 设置 marker 和 name，用于之后点击才选中\n      setSearchMarker({\n        position: [center.lat, center.lng],\n        name\n      });\n    });\n    return () => map.removeControl(geocoder);\n  }, [map, setSearchMarker]);\n  return null;\n}\n\n// 点击地图获取位置 + 返回地址\n_s(GeocoderControl, \"IoceErwr5KVGS9kN4RQ1bOkYMAg=\", false, function () {\n  return [useMap];\n});\n_c = GeocoderControl;\nfunction LocationMarker({\n  onSelect\n}) {\n  _s2();\n  const [position, setPosition] = useState(null);\n  const [popupText, setPopupText] = useState(null);\n  const map = useMap();\n  useMapEvents({\n    click: async e => {\n      const {\n        lat,\n        lng\n      } = e.latlng;\n      setPosition([lat, lng]);\n      try {\n        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=en`);\n        const data = await res.json();\n        const locationName = data.display_name || 'Unknown';\n        setPopupText(locationName);\n        onSelect(locationName);\n      } catch (err) {\n        console.error('Reverse geocoding error:', err);\n        setPopupText(\"Unknown location\");\n      }\n    }\n  });\n  return position ? /*#__PURE__*/_jsxDEV(Marker, {\n    position: position,\n    children: popupText && /*#__PURE__*/_jsxDEV(Popup, {\n      children: popupText\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 21\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this) : null;\n}\n_s2(LocationMarker, \"PRHEHUDgi2T5xqkoIrxyQLDChTY=\", false, function () {\n  return [useMap, useMapEvents];\n});\n_c2 = LocationMarker;\nexport default function MapView({\n  onLocationSelected\n}) {\n  return /*#__PURE__*/_jsxDEV(MapContainer, {\n    center: [37.7749, -122.4194],\n    zoom: 13,\n    scrollWheelZoom: true,\n    style: {\n      height: '100%',\n      width: '100%'\n    },\n    children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n      attribution: \"\\xA9 OpenStreetMap contributors\",\n      url: \"https://a.tile.openstreetmap.de/{z}/{x}/{y}.png\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(GeocoderControl, {\n      onSelect: onLocationSelected\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(LocationMarker, {\n      onSelect: onLocationSelected\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this);\n}\n_c3 = MapView;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"GeocoderControl\");\n$RefreshReg$(_c2, \"LocationMarker\");\n$RefreshReg$(_c3, \"MapView\");","map":{"version":3,"names":["React","useState","useEffect","Popup","MapContainer","TileLayer","Marker","useMap","useMapEvents","L","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconUrl","iconRetinaUrl","shadowUrl","GeocoderControl","setSearchMarker","_s","map","Control","Geocoder","geocoder","position","defaultMarkGeocode","placeholder","nominatim","addTo","on","e","center","name","geocode","setView","getZoom","lat","lng","removeControl","_c","LocationMarker","onSelect","_s2","setPosition","popupText","setPopupText","click","latlng","res","fetch","data","json","locationName","display_name","err","console","error","children","fileName","_jsxFileName","lineNumber","columnNumber","_c2","MapView","onLocationSelected","zoom","scrollWheelZoom","style","height","width","attribution","url","_c3","$RefreshReg$"],"sources":["/Users/jsy/Desktop/ai-travel-app/frontend/src/pages/MapView.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Popup} from 'react-leaflet';\n\nimport {\n  MapContainer,\n  TileLayer,\n  Marker,\n  useMap,\n  useMapEvents\n} from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet-control-geocoder/dist/Control.Geocoder.css';\nimport 'leaflet-control-geocoder'; // 默认挂载到 L.Control.Geocoder\n\nimport './MapView.css';\n\n// 修复图标不显示\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'\n});\n\n// 搜索控件\nfunction GeocoderControl({ setSearchMarker }) {\n  const map = useMap();\n\n  useEffect(() => {\n    if (!map || !L.Control.Geocoder) return;\n\n    const geocoder = L.Control.geocoder({\n      position: 'topleft',\n      defaultMarkGeocode: true, \n      placeholder: 'Search location...',\n      geocoder: L.Control.Geocoder.nominatim()\n    }).addTo(map);\n\n    geocoder.on('markgeocode', function (e) {\n      const { center, name } = e.geocode;\n      map.setView(center, map.getZoom());\n\n      // ✅ 设置 marker 和 name，用于之后点击才选中\n      setSearchMarker({ position: [center.lat, center.lng], name });\n    });\n\n    return () => map.removeControl(geocoder);\n  }, [map, setSearchMarker]);\n\n  return null;\n}\n\n\n\n// 点击地图获取位置 + 返回地址\nfunction LocationMarker({ onSelect }) {\n  const [position, setPosition] = useState(null);\n  const [popupText, setPopupText] = useState(null);\n  const map = useMap();\n  useMapEvents({\n    click: async (e) => {\n      const { lat, lng } = e.latlng;\n      setPosition([lat, lng]);\n\n      try {\n        const res = await fetch(\n          `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=en`\n        );\n        const data = await res.json();\n        const locationName = data.display_name || 'Unknown';\n        setPopupText(locationName);\n        onSelect(locationName);\n      } catch (err) {\n        console.error('Reverse geocoding error:', err);\n        setPopupText(\"Unknown location\");\n      }\n    }\n  });\n\n    return position ? (\n    <Marker position={position}>\n      {popupText && <Popup>{popupText}</Popup>}\n    </Marker> ) : null;\n}\n\nexport default function MapView({ onLocationSelected }) {\n  return (\n    <MapContainer\n      center={[37.7749, -122.4194]}\n      zoom={13}\n      scrollWheelZoom={true}\n      style={{ height: '100%', width: '100%' }}\n    >\n      <TileLayer\n        attribution=\"&copy; OpenStreetMap contributors\"\n        url=\"https://a.tile.openstreetmap.de/{z}/{x}/{y}.png\"\n      />\n      <GeocoderControl onSelect={onLocationSelected} />\n\n      <LocationMarker onSelect={onLocationSelected} />\n    </MapContainer>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}