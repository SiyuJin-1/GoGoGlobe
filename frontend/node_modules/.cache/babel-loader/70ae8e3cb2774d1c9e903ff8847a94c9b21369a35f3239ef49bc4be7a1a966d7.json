{"ast":null,"code":"var _jsxFileName = \"/Users/jsy/Desktop/ai-travel-app/frontend/src/pages/MapView.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { MapContainer, TileLayer, Marker, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet-control-geocoder/dist/Control.Geocoder.css';\nimport 'leaflet-control-geocoder';\nimport * as LGeocoder from 'leaflet-control-geocoder';\nimport './MapView.css';\n\n// 修复图标不显示\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'\n});\n\n// 注册 geocoder\nif (typeof L.Control.Geocoder === 'undefined') {\n  L.Control.Geocoder = LGeocoder.Geocoder;\n}\n\n// 添加 Geocoder 控件\nfunction GeocoderControl() {\n  _s();\n  const map = useMap();\n  useEffect(() => {\n    const geocoder = L.Control.geocoder({\n      position: 'topright',\n      defaultMarkGeocode: true,\n      placeholder: 'Search location...',\n      geocoder: L.Control.Geocoder.nominatim()\n    }).addTo(map);\n    return () => {\n      map.removeControl(geocoder);\n    };\n  }, [map]);\n  return null;\n}\n\n// 点击地图获取位置\n_s(GeocoderControl, \"IoceErwr5KVGS9kN4RQ1bOkYMAg=\", false, function () {\n  return [useMap];\n});\n_c = GeocoderControl;\nfunction LocationPicker({\n  onSelect\n}) {\n  _s2();\n  const map = useMap();\n  const [markerPos, setMarkerPos] = useState(null);\n  useEffect(() => {\n    const handleClick = async e => {\n      const {\n        lat,\n        lng\n      } = e.latlng;\n      setMarkerPos([lat, lng]);\n      try {\n        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=en`);\n        const data = await res.json();\n        const name = data.display_name || 'Unknown';\n        onSelect(name);\n      } catch (err) {\n        console.error('Reverse geocoding error:', err);\n        onSelect('Unknown');\n      }\n    };\n    map.on('click', handleClick);\n    return () => map.off('click', handleClick);\n  }, [map, onSelect]);\n  return markerPos ? /*#__PURE__*/_jsxDEV(Marker, {\n    position: markerPos\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 22\n  }, this) : null;\n}\n_s2(LocationPicker, \"7HDfIS6q9mVwoYjJ2zF64iDVi/U=\", false, function () {\n  return [useMap];\n});\n_c2 = LocationPicker;\nexport default function MapView({\n  onLocationSelected\n}) {\n  return /*#__PURE__*/_jsxDEV(MapContainer, {\n    center: [37.7749, -122.4194],\n    zoom: 13,\n    scrollWheelZoom: true,\n    style: {\n      height: '100%',\n      width: '100%'\n    },\n    children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n      attribution: \"\\xA9 OpenStreetMap contributors\",\n      url: \"https://a.tile.openstreetmap.de/{z}/{x}/{y}.png\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(GeocoderControl, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(LocationPicker, {\n      onSelect: onLocationSelected\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 5\n  }, this);\n}\n_c3 = MapView;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"GeocoderControl\");\n$RefreshReg$(_c2, \"LocationPicker\");\n$RefreshReg$(_c3, \"MapView\");","map":{"version":3,"names":["React","useState","useEffect","MapContainer","TileLayer","Marker","useMap","L","LGeocoder","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconUrl","iconRetinaUrl","shadowUrl","Control","Geocoder","GeocoderControl","_s","map","geocoder","position","defaultMarkGeocode","placeholder","nominatim","addTo","removeControl","_c","LocationPicker","onSelect","_s2","markerPos","setMarkerPos","handleClick","e","lat","lng","latlng","res","fetch","data","json","name","display_name","err","console","error","on","off","fileName","_jsxFileName","lineNumber","columnNumber","_c2","MapView","onLocationSelected","center","zoom","scrollWheelZoom","style","height","width","children","attribution","url","_c3","$RefreshReg$"],"sources":["/Users/jsy/Desktop/ai-travel-app/frontend/src/pages/MapView.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { MapContainer, TileLayer, Marker, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet-control-geocoder/dist/Control.Geocoder.css';\nimport 'leaflet-control-geocoder';\nimport * as LGeocoder from 'leaflet-control-geocoder';\nimport './MapView.css';\n\n// 修复图标不显示\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',\n});\n\n// 注册 geocoder\nif (typeof L.Control.Geocoder === 'undefined') {\n  L.Control.Geocoder = LGeocoder.Geocoder;\n}\n\n// 添加 Geocoder 控件\nfunction GeocoderControl() {\n  const map = useMap();\n\n  useEffect(() => {\n    const geocoder = L.Control.geocoder({\n      position: 'topright',\n      defaultMarkGeocode: true,\n      placeholder: 'Search location...',\n      geocoder: L.Control.Geocoder.nominatim()\n    }).addTo(map);\n\n    return () => {\n      map.removeControl(geocoder);\n    };\n  }, [map]);\n\n  return null;\n}\n\n// 点击地图获取位置\nfunction LocationPicker({ onSelect }) {\n  const map = useMap();\n  const [markerPos, setMarkerPos] = useState(null);\n\n  useEffect(() => {\n    const handleClick = async (e) => {\n      const { lat, lng } = e.latlng;\n      setMarkerPos([lat, lng]);\n\n      try {\n        const res = await fetch(\n          `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=en`\n        );\n        const data = await res.json();\n        const name = data.display_name || 'Unknown';\n        onSelect(name);\n      } catch (err) {\n        console.error('Reverse geocoding error:', err);\n        onSelect('Unknown');\n      }\n    };\n\n    map.on('click', handleClick);\n    return () => map.off('click', handleClick);\n  }, [map, onSelect]);\n\n  return markerPos ? <Marker position={markerPos} /> : null;\n}\n\nexport default function MapView({ onLocationSelected }) {\n  return (\n    <MapContainer\n      center={[37.7749, -122.4194]}\n      zoom={13}\n      scrollWheelZoom={true}\n      style={{ height: '100%', width: '100%' }}\n    >\n      <TileLayer\n        attribution=\"&copy; OpenStreetMap contributors\"\n        url=\"https://a.tile.openstreetmap.de/{z}/{x}/{y}.png\"\n      />\n      <GeocoderControl />\n      <LocationPicker onSelect={onLocationSelected} />\n    </MapContainer>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}